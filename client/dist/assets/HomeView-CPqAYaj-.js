import{u as O,I as Z,a as Q}from"./ImageModal-BRCmjV0P.js";import{_ as E,r as m,o as N,w as A,c as l,a as o,b as M,d as e,n as V,e as z,v as Y,f as C,g as w,F as D,h as L,i as U,j as R,t as y,k as _,l as ee,m as te,p as G,u as b,q as H}from"./index-CrRd_1UB.js";import"./index-_2kYfvNG.js";const se={class:"generate-panel"},ae={class:"form"},oe={class:"form-group prompt-group"},ne={class:"form-group"},le={key:0,class:"upload-placeholder"},ie={key:1,class:"preview-grid"},re=["src","alt"],ce={class:"preview-overlay"},de=["onClick"],ue={class:"params-section"},ve={class:"params-grid"},pe={class:"param-item"},ge={class:"select-wrapper"},ke={class:"param-item"},me={class:"select-wrapper"},we=["disabled"],he=20,ye=10*1024*1024,fe={__name:"GeneratePanel",emits:["generate"],setup(a,{emit:i}){const f=i,v=O(),r=m(""),s=m("auto"),p=m("1K"),B=m(null),I=m(null),u=m([]),S=m(!1),$=m(!1);N(()=>{v.loadFormState(),j()});const j=()=>{r.value=v.formState.prompt||"",s.value=v.formState.aspectRatio||"auto",p.value=v.formState.imageSize||"1K",u.value=v.formState.referenceImages||[],setTimeout(()=>{P()},0)};A(()=>v.formState,()=>{j()},{deep:!0}),A([r,s,p],()=>{v.saveFormState({prompt:r.value,aspectRatio:s.value,imageSize:p.value})}),A(u,()=>{v.updateFormState({referenceImages:u.value})},{deep:!0});const T=()=>{var n;(n=I.value)==null||n.click()},c=n=>{const t=Array.from(n.target.files||[]);F(t),n.target.value=""},g=n=>{const t=Array.from(n.dataTransfer.files||[]);F(t)},k=n=>{$.value=!1,g(n)},F=async n=>{const t=["image/jpeg","image/jpg","image/png","image/webp"],d=n.filter(x=>t.includes(x.type)?x.size>ye?(alert(`文件 ${x.name} 超过10MB限制，已跳过`),!1):!0:!1),h=he-u.value.length,K=d.slice(0,h);for(const x of K){const J=await W(x);u.value.push({file:x,preview:URL.createObjectURL(x),base64:J})}},W=n=>new Promise((t,d)=>{const h=new FileReader;h.onload=()=>t(h.result),h.onerror=d,h.readAsDataURL(n)}),X=n=>{URL.revokeObjectURL(u.value[n].preview),u.value.splice(n,1)},P=()=>{const n=B.value;n&&(n.style.height="0",n.style.height=Math.max(60,n.scrollHeight)+"px")},q=()=>{if(!r.value.trim())return;const n=u.value.map(t=>t.base64);f("generate",{prompt:r.value,aspectRatio:s.value,imageSize:p.value,urls:n.length>0?n:void 0})};return(n,t)=>(o(),l("div",se,[t[17]||(t[17]=M('<div class="panel-header" data-v-aacae7c5><div class="header-icon" data-v-aacae7c5><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-aacae7c5><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" data-v-aacae7c5></polygon></svg></div><div class="header-text" data-v-aacae7c5><h2 class="title" data-v-aacae7c5>创作灵感</h2><p class="subtitle" data-v-aacae7c5>用文字描述你想要的画面，AI 将为你实现</p></div></div>',1)),e("div",ae,[e("div",oe,[e("div",{class:V(["textarea-wrapper",{focused:S.value}])},[z(e("textarea",{ref_key:"textareaRef",ref:B,"onUpdate:modelValue":t[0]||(t[0]=d=>r.value=d),class:"textarea",placeholder:"描述你想要生成的画面，越详细效果越好...",onInput:P,onFocus:t[1]||(t[1]=d=>S.value=!0),onBlur:t[2]||(t[2]=d=>S.value=!1)},null,544),[[Y,r.value]])],2)]),e("div",ne,[t[10]||(t[10]=M('<div class="label-row" data-v-aacae7c5><label class="label" data-v-aacae7c5><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-aacae7c5><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-aacae7c5></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-aacae7c5></circle><polyline points="21 15 16 10 5 21" data-v-aacae7c5></polyline></svg> 参考图 </label><span class="label-hint" data-v-aacae7c5>可选，最多20张</span></div>',1)),e("div",{class:V(["upload-area",{"has-images":u.value.length>0,"drag-over":$.value}]),onClick:T,onDragover:t[3]||(t[3]=C(d=>$.value=!0,["prevent"])),onDragleave:t[4]||(t[4]=C(d=>$.value=!1,["prevent"])),onDrop:C(k,["prevent"])},[e("input",{ref_key:"fileInputRef",ref:I,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",multiple:"",class:"file-input",onChange:c},null,544),u.value.length===0?(o(),l("div",le,[...t[7]||(t[7]=[M('<div class="upload-icon-wrapper" data-v-aacae7c5><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-aacae7c5><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-aacae7c5></path><polyline points="17 8 12 3 7 8" data-v-aacae7c5></polyline><line x1="12" y1="3" x2="12" y2="15" data-v-aacae7c5></line></svg></div><p class="upload-text" data-v-aacae7c5>点击或拖拽上传参考图</p><p class="upload-hint" data-v-aacae7c5>支持 JPG、PNG、WEBP，单张不超过 10MB</p>',3)])])):(o(),l("div",ie,[(o(!0),l(D,null,L(u.value,(d,h)=>(o(),l("div",{key:h,class:"preview-item"},[e("img",{src:d.preview,alt:"参考图 "+(h+1)},null,8,re),e("div",ce,[e("button",{class:"remove-btn",onClick:C(K=>X(h),["stop"]),title:"移除"},[...t[8]||(t[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,de)])]))),128)),u.value.length<20?(o(),l("div",{key:0,class:"add-more",onClick:C(T,["stop"])},[...t[9]||(t[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])):w("",!0)]))],34)]),e("div",ue,[t[15]||(t[15]=e("div",{class:"params-header"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"12",cy:"12",r:"3"}),e("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]),e("span",null,"生成参数")],-1)),e("div",ve,[e("div",pe,[t[12]||(t[12]=e("label",{class:"param-label"},"画面比例",-1)),e("div",ge,[z(e("select",{"onUpdate:modelValue":t[5]||(t[5]=d=>s.value=d),class:"select"},[...t[11]||(t[11]=[M('<option value="auto" data-v-aacae7c5>自动</option><option value="1:1" data-v-aacae7c5>1:1 正方形</option><option value="16:9" data-v-aacae7c5>16:9 横版</option><option value="9:16" data-v-aacae7c5>9:16 竖版</option><option value="4:3" data-v-aacae7c5>4:3</option><option value="3:4" data-v-aacae7c5>3:4</option><option value="3:2" data-v-aacae7c5>3:2</option><option value="2:3" data-v-aacae7c5>2:3</option><option value="5:4" data-v-aacae7c5>5:4</option><option value="4:5" data-v-aacae7c5>4:5</option><option value="21:9" data-v-aacae7c5>21:9 超宽</option>',11)])],512),[[U,s.value]])])]),e("div",ke,[t[14]||(t[14]=e("label",{class:"param-label"},"输出分辨率",-1)),e("div",me,[z(e("select",{"onUpdate:modelValue":t[6]||(t[6]=d=>p.value=d),class:"select"},[...t[13]||(t[13]=[e("option",{value:"1K"},"1K 标准",-1),e("option",{value:"2K"},"2K 高清",-1),e("option",{value:"4K"},"4K 超清",-1)])],512),[[U,p.value]])])])])]),e("button",{class:"generate-btn",onClick:q,disabled:!r.value.trim()},[...t[16]||(t[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})],-1),e("span",null,"开始生成",-1)])],8,we)])]))}},xe=E(fe,[["__scopeId","data-v-aacae7c5"]]),$e={class:"task-header"},be={key:0,class:"status-icon"},Se={key:1,class:"status-icon spinning"},Ce={key:2,class:"status-icon"},Re={key:3,class:"status-icon"},Be={key:4,class:"status-icon"},Ie={class:"status-text"},je={key:5,class:"progress-text"},Te={class:"task-actions"},Me={class:"task-prompt"},Ve={class:"task-meta"},Fe={class:"meta-tag"},Ae={class:"meta-tag"},ze={key:0,class:"meta-tag ref-tag"},De={key:0,class:"progress-bar"},Le={key:1,class:"task-footer error-footer"},Ee={class:"error-text"},Pe={__name:"TaskCard",props:{task:{type:Object,required:!0}},emits:["remove","retry","cancel"],setup(a){const i=a,f=R(()=>({pending:"排队中",running:"生成中",succeeded:"完成",failed:"失败",cancelled:"已取消"})[i.task.status]||i.task.status),v=R(()=>{const r=i.task.prompt||"";return r.length>50?r.substring(0,50)+"...":r});return(r,s)=>(o(),l("div",{class:V(["task-card",a.task.status])},[e("div",$e,[e("div",{class:V(["status-badge",a.task.status])},[a.task.status==="pending"?(o(),l("span",be,[...s[3]||(s[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("polyline",{points:"12 6 12 12 16 14"})],-1)])])):a.task.status==="running"?(o(),l("span",Se,[...s[4]||(s[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"23 4 23 10 17 10"}),e("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})],-1)])])):a.task.status==="succeeded"?(o(),l("span",Ce,[...s[5]||(s[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"20 6 9 17 4 12"})],-1)])])):a.task.status==="failed"?(o(),l("span",Re,[...s[6]||(s[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),e("line",{x1:"9",y1:"9",x2:"15",y2:"15"})],-1)])])):a.task.status==="cancelled"?(o(),l("span",Be,[...s[7]||(s[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])):w("",!0),e("span",Ie,y(f.value),1),a.task.status==="running"&&a.task.progress>0?(o(),l("span",je,y(a.task.progress)+"%",1)):w("",!0)],2),e("div",Te,[a.task.status==="pending"||a.task.status==="running"?(o(),l("button",{key:0,class:"action-icon-btn cancel",onClick:s[0]||(s[0]=p=>r.$emit("cancel",a.task.id)),title:"取消任务"},[...s[8]||(s[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),e("line",{x1:"9",y1:"9",x2:"15",y2:"15"})],-1)])])):w("",!0),a.task.status==="failed"||a.task.status==="cancelled"||a.task.status==="succeeded"?(o(),l("button",{key:1,class:"action-icon-btn close",onClick:s[1]||(s[1]=p=>r.$emit("remove",a.task.id)),title:"移除任务"},[...s[9]||(s[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])):w("",!0)])]),e("div",Me,y(v.value),1),e("div",Ve,[e("span",Fe,y(a.task.aspectRatio),1),e("span",Ae,y(a.task.imageSize),1),a.task.hasReferenceImages?(o(),l("span",ze,[...s[10]||(s[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e("polyline",{points:"21 15 16 10 5 21"})],-1),_(" 参考图 ",-1)])])):w("",!0)]),a.task.status==="running"||a.task.status==="pending"?(o(),l("div",De,[e("div",{class:"progress-fill",style:ee({width:a.task.progress+"%"})},null,4)])):w("",!0),a.task.status==="failed"?(o(),l("div",Le,[e("p",Ee,y(a.task.error),1),e("button",{class:"retry-btn",onClick:s[2]||(s[2]=p=>r.$emit("retry",a.task.id))},[...s[11]||(s[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"23 4 23 10 17 10"}),e("polyline",{points:"1 20 1 14 7 14"}),e("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})],-1),_(" 重试 ",-1)])])])):w("",!0)],2))}},Ke=E(Pe,[["__scopeId","data-v-34382335"]]),Ue={class:"home-view"},_e={class:"main-content"},Ge={class:"container"},He={key:0,class:"tasks-section"},Oe={class:"section-header"},Ne={class:"task-count"},We={class:"tasks-grid"},Xe={key:0,class:"expand-controls"},qe={class:"expand-icon"},Je={key:1,class:"recent-section"},Ze={class:"image-grid"},Qe=3,Ye=2,et={__name:"HomeView",setup(a){const i=O(),f=m(!1),v=m(null),r=m(!1),s=Qe*Ye,p=R(()=>r.value||i.tasks.length<=s?i.tasks:i.tasks.slice(0,s)),B=R(()=>i.tasks.length>s),I=()=>{r.value=!r.value},u=R(()=>i.images.slice(0,8)),S=async c=>{i.createTask(c)},$=c=>{v.value=c,f.value=!0},j=async c=>{if(confirm("确定要删除这张图片吗？"))try{await i.deleteImage(c)}catch{alert("删除失败")}},T=c=>{const g=(c.urls||[]).map((k,F)=>({preview:k,base64:k,file:null}));i.updateFormState({prompt:c.prompt,aspectRatio:c.aspectRatio,imageSize:c.imageSize,referenceImages:g}),i.saveFormState({prompt:c.prompt,aspectRatio:c.aspectRatio,imageSize:c.imageSize})};return N(()=>{i.init()}),te(()=>{i.stopPolling()}),(c,g)=>(o(),l("div",Ue,[e("main",_e,[e("div",Ge,[G(xe,{onGenerate:S}),b(i).tasks.length>0?(o(),l("section",He,[e("div",Oe,[g[1]||(g[1]=e("h3",{class:"section-title"},"生成任务",-1)),e("span",Ne,y(b(i).tasks.length)+"个任务",1)]),e("div",We,[(o(!0),l(D,null,L(p.value,k=>(o(),H(Ke,{key:k.id,task:k,onRemove:b(i).removeTask,onRetry:b(i).retryTask,onCancel:b(i).cancelTask},null,8,["task","onRemove","onRetry","onCancel"]))),128))]),B.value?(o(),l("div",Xe,[e("button",{class:"expand-btn",onClick:I},[e("span",null,y(r.value?"收起":"展开更多"),1),e("span",qe,y(r.value?"▲":"▼"),1)])])):w("",!0)])):w("",!0),b(i).images.length>0?(o(),l("section",Je,[g[2]||(g[2]=e("h3",{class:"section-title"},"最近生成",-1)),e("div",Ze,[(o(!0),l(D,null,L(u.value,k=>(o(),H(Q,{key:k.id,image:k,onView:$,onDelete:j,onRegenerate:T},null,8,["image"]))),128))])])):w("",!0)])]),G(Z,{visible:f.value,image:v.value,onClose:g[0]||(g[0]=k=>f.value=!1)},null,8,["visible","image"])]))}},ot=E(et,[["__scopeId","data-v-e28e5749"]]);export{ot as default};
