import{D as $,r as w,E as b,G as k,_ as z,c as C,a as S,d as a,b as B,t as c,g as _,n as A,x as M,f as N,T as V}from"./index-CGveUXC2.js";const ie=$("image",()=>{const s=w([]),m=w(!1),o=w([]);let r=null;const i=w({prompt:"",aspectRatio:"auto",imageSize:"1K",referenceImages:[]}),g=()=>{try{const t=localStorage.getItem("nano-banana-form-state");if(t){const e=JSON.parse(t);i.value={...i.value,...e}}}catch(t){console.error("恢复表单状态失败:",t)}},u=t=>{try{i.value={...i.value,...t};const e={prompt:i.value.prompt,aspectRatio:i.value.aspectRatio,imageSize:i.value.imageSize};localStorage.setItem("nano-banana-form-state",JSON.stringify(e))}catch(e){console.error("保存表单状态失败:",e)}},p=t=>{i.value={...i.value,...t}},l=async()=>{m.value=!0;try{const t=await b.getList();s.value=t.images||[]}catch(t){console.error("获取图片列表失败:",t)}finally{m.value=!1}},n=async()=>{try{const t=await k.getAll();o.value=t.tasks||[]}catch(t){console.error("获取任务列表失败:",t)}},h=()=>{r||(r=setInterval(async()=>{if(o.value.filter(e=>e.status==="pending"||e.status==="running").length!==0)try{((await k.getAll()).tasks||[]).forEach(d=>{const I=o.value.findIndex(T=>T.id===d.id);I>-1?(o.value[I].status!=="succeeded"&&d.status==="succeeded"&&(l(),setTimeout(()=>{x(d.id)},5e3)),o.value[I]=d):(d.status==="pending"||d.status==="running")&&o.value.push(d)})}catch(e){console.error("轮询任务失败:",e)}},2e3))},y=()=>{r&&(clearInterval(r),r=null)},f=async t=>{try{const e=await b.generate(t);return e.task&&o.value.unshift(e.task),h(),e.taskId}catch(e){throw console.error("创建任务失败:",e),e}},R=async t=>{try{await k.cancel(t);const e=o.value.find(v=>v.id===t);e&&(e.status="cancelled")}catch(e){throw console.error("取消任务失败:",e),e}},x=async t=>{try{await k.delete(t)}catch{}const e=o.value.findIndex(v=>v.id===t);e>-1&&o.value.splice(e,1)};return{images:s,loading:m,tasks:o,formState:i,fetchImages:l,fetchTasks:n,createTask:f,cancelTask:R,removeTask:x,retryTask:async t=>{const e=o.value.find(d=>d.id===t);if(!e)return;const v={prompt:e.prompt,aspectRatio:e.aspectRatio,imageSize:e.imageSize};await x(t),await f(v)},deleteImage:async t=>{try{await b.delete(t),s.value=s.value.filter(e=>e.id!==t)}catch(e){throw console.error("删除图片失败:",e),e}},init:async()=>{await Promise.all([l(),n()]),h()},startPolling:h,stopPolling:y,loadFormState:g,saveFormState:u,updateFormState:p}}),j={class:"image-card"},D={class:"image-wrapper"},P=["src","alt"],L={class:"card-info"},O={class:"prompt"},E={class:"meta-row"},F={class:"user"},J={class:"time"},q={class:"specs"},G={__name:"ImageCard",props:{image:{type:Object,required:!0}},emits:["view","delete","regenerate"],setup(s,{emit:m}){const o=s,r=m,i=()=>{r("view",o.image)},g=()=>{r("delete",o.image.id)},u=()=>{r("regenerate",{prompt:o.image.prompt,aspectRatio:o.image.aspectRatio,imageSize:o.image.imageSize,urls:o.image.referenceUrls||[]})},p=l=>new Date(l).toLocaleString("zh-CN",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"});return(l,n)=>(S(),C("div",j,[a("div",D,[a("img",{src:s.image.url,alt:s.image.prompt,class:"image"},null,8,P),a("div",{class:"overlay"},[a("button",{class:"action-btn view",onClick:i,title:"查看大图"},[...n[0]||(n[0]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[a("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),a("circle",{cx:"12",cy:"12",r:"3"})],-1)])]),a("button",{class:"action-btn regenerate",onClick:u,title:"重新生成"},[...n[1]||(n[1]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[a("polyline",{points:"23 4 23 10 17 10"}),a("polyline",{points:"1 20 1 14 7 14"}),a("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})],-1)])]),a("button",{class:"action-btn delete",onClick:g,title:"删除"},[...n[2]||(n[2]=[B('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-08739cfc><polyline points="3 6 5 6 21 6" data-v-08739cfc></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" data-v-08739cfc></path><line x1="10" y1="11" x2="10" y2="17" data-v-08739cfc></line><line x1="14" y1="11" x2="14" y2="17" data-v-08739cfc></line></svg>',1)])])])]),a("div",L,[a("p",O,c(s.image.prompt),1),a("div",E,[a("p",F,c(s.image.username||"匿名"),1),a("p",J,c(p(s.image.createdAt)),1),a("p",q,c(s.image.aspectRatio)+" · "+c(s.image.imageSize),1),s.image.apiType?(S(),C("span",{key:0,class:A(["api-badge",s.image.apiType])},c(s.image.apiType==="primary"?"主":"备"),3)):_("",!0)])])]))}},ne=z(G,[["__scopeId","data-v-08739cfc"]]),H={class:"image-container"},K=["src","alt"],U={class:"modal-info"},Q={class:"prompt"},W={class:"meta"},X={class:"tag"},Y={class:"tag"},Z={class:"time"},ee={__name:"ImageModal",props:{visible:Boolean,image:Object},emits:["close"],setup(s,{emit:m}){const o=m,r=()=>{o("close")},i=g=>g?new Date(g).toLocaleString("zh-CN"):"";return(g,u)=>{var p,l,n,h,y,f;return S(),M(V,{to:"body"},[s.visible?(S(),C("div",{key:0,class:"modal-overlay",onClick:r},[a("div",{class:"modal-content",onClick:u[0]||(u[0]=N(()=>{},["stop"]))},[a("button",{class:"close-btn",onClick:r},"×"),a("div",H,[a("img",{src:(p=s.image)==null?void 0:p.url,alt:(l=s.image)==null?void 0:l.prompt,class:"modal-image"},null,8,K)]),a("div",U,[a("p",Q,c((n=s.image)==null?void 0:n.prompt),1),a("div",W,[a("span",X,c((h=s.image)==null?void 0:h.aspectRatio),1),a("span",Y,c((y=s.image)==null?void 0:y.imageSize),1),a("span",Z,c(i((f=s.image)==null?void 0:f.createdAt)),1)])])])])):_("",!0)])}}},re=z(ee,[["__scopeId","data-v-d920e3a5"]]);export{re as I,ne as a,ie as u};
