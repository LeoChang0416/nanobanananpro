import{_ as pe,r as w,j as ge,o as ve,c as a,d as n,k as R,e as X,i as fe,F as I,h as H,g as C,b as ke,v as ye,s as me,f as Y,t as M,x as _e,a as o,n as N}from"./index-CrRd_1UB.js";import{c as we}from"./index-_2kYfvNG.js";const xe={class:"chat-view"},Ce={class:"chat-container"},be={class:"chat-sidebar"},Te={class:"model-selector"},$e={class:"select-wrapper"},Ee={class:"chat-history"},Me=["onClick"],Be={class:"history-title"},De=["onClick"],Fe={class:"chat-main"},Ae={key:0,class:"empty-state"},Se={class:"message-avatar"},Ie={key:0,class:"avatar-icon user"},He={key:1,class:"avatar-icon assistant"},Ne={class:"message-content-wrapper"},Le={key:0,class:"attachment-grid"},Ve=["src"],We={key:1,class:"msg-file"},Oe={class:"message-bubble"},Re={key:0,class:"initial-loading"},je={key:1,class:"thinking-module"},Ke=["onClick"],ze={class:"thinking-status"},Pe={key:0,class:"thinking-dots"},Ue={key:1,class:"thinking-duration"},qe={class:"thinking-content-inner"},Ge={key:0,class:"cursor"},Qe={key:2,class:"markdown-body"},Je=["innerHTML"],Xe={key:0,class:"cursor block-cursor"},Ye={class:"input-container"},Ze={key:0,class:"attachment-preview"},et={key:0,class:"image-preview"},tt=["src"],nt={key:1,class:"file-preview"},st={class:"file-name"},it=["onClick"],lt={class:"input-wrapper"},at=["onKeydown"],ot=["disabled","title"],rt={key:0,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},ct={key:1,class:"loading-spinner"},dt={class:"input-hint"},ht={class:"model-badge"},ut={__name:"ChatView",setup(pt){const A=w("gemini-3-pro"),B=w(""),b=w(!1),L=w(null),D=w(null),j=w(null),f=w([]),m=w([{title:"æ–°å¯¹è¯",messages:[]}]),T=w(0),K=ge(()=>{var s;return((s=m.value[T.value])==null?void 0:s.messages)||[]});function Z(){m.value.unshift({title:"æ–°å¯¹è¯",messages:[]}),T.value=0,f.value=[]}function ee(s){T.value=s,f.value=[]}function te(s){m.value.length===1?m.value[0]={title:"æ–°å¯¹è¯",messages:[]}:(m.value.splice(s,1),T.value>=m.value.length&&(T.value=m.value.length-1))}function ne(s){s.shiftKey||(s.preventDefault(),P())}function se(){const s=D.value;s&&(s.style.height="auto",s.style.height=Math.min(s.scrollHeight,200)+"px")}const ie=()=>{var s;return(s=j.value)==null?void 0:s.click()},le=async s=>{const e=Array.from(s.target.files);e.length&&(await z(e),s.target.value="")},ae=async s=>{var l;const e=(l=s.clipboardData)==null?void 0:l.items;if(!e)return;const t=[];for(const h of e)h.kind==="file"&&t.push(h.getAsFile());t.length>0&&await z(t)},z=async s=>{for(const e of s)if(e.type.startsWith("image/")){const t=new FileReader;t.onload=l=>{f.value.push({type:"image",name:e.name,preview:l.target.result,content:l.target.result})},t.readAsDataURL(e)}else if(e.type.startsWith("text/")||e.name.match(/\.(json|js|py|html|css|md|vue|ts)$/i)){const t=new FileReader;t.onload=l=>{f.value.push({type:"text",name:e.name,preview:null,content:l.target.result})},t.readAsText(e)}else{const t=new FileReader;t.onload=l=>{f.value.push({type:"text",name:e.name,preview:null,content:l.target.result})},t.readAsText(e)}},oe=s=>{f.value.splice(s,1)};function re(s){const e=s.match(/<think>([\s\S]*?)<\/think>/i);if(e){const l=e[1].trim(),h=s.replace(/<think>[\s\S]*?<\/think>/gi,"").trim();return{thinking:l,content:h}}const t=s.match(/<think>([\s\S]*)/i);return t?{thinking:t[1].trim(),content:""}:{thinking:null,content:s}}async function P(){var v,r,d;const s=B.value.trim();if(!s&&f.value.length===0||b.value)return;const e=m.value[T.value],t=s,l=[...f.value];e.messages.push({role:"user",content:t,attachments:l}),e.messages.length===1&&(e.title=s.slice(0,20)+(s.length>20?"...":"")||"æ–‡ä»¶åˆ†æ"),B.value="",f.value=[],D.value&&(D.value.style.height="auto"),b.value=!0,V();const h=e.messages.push({role:"assistant",content:"",displayContent:"",thinking:"",displayThinking:"",thinkingExpanded:!0,finished:!1,thinkingFinished:!1,contentTyping:!1,thinkingTyping:!1,startTime:Date.now(),thinkingDuration:0})-1,i=e.messages[h];let c="",u="",y=Date.now();(()=>{const p=()=>{const k=Date.now();if(k-y>=16){if(y=k,c.length>0){i.thinkingTyping=!0;const x=Math.ceil(c.length/10)||1,g=c.slice(0,x);i.displayThinking+=g,c=c.slice(x),V()}if(u.length>0){i.contentTyping=!0;const x=Math.ceil(u.length/5)||1,g=u.slice(0,x);i.displayContent+=g,u=u.slice(x),V()}else i.contentTyping=!1}!i.finished||c.length>0||u.length>0?requestAnimationFrame(p):(i.contentTyping=!1,i.thinkingTyping=!1)};requestAnimationFrame(p)})();try{const p=e.messages.slice(0,-1).map(g=>{let _=[];return g.content&&_.push({type:"text",text:g.content}),g.attachments&&g.attachments.length>0&&g.attachments.forEach($=>{$.type==="image"?_.push({type:"image_url",image_url:{url:$.content}}):$.type==="text"&&_.push({type:"text",text:`

File: ${$.name}
Content:
${$.content}
`})}),_.length===1&&_[0].type==="text"?{role:g.role,content:_[0].text}:g.role==="assistant"?{role:g.role,content:g.content||g.displayContent}:{role:g.role,content:_}}),U=(await we.sendMessage(p,A.value,!0)).body.getReader(),q=new TextDecoder;let x="";for(;;){const{done:g,value:_}=await U.read();if(g)break;const he=q.decode(_).split(`
`);for(const G of he)if(G.startsWith("data: ")){const Q=G.slice(6);if(Q==="[DONE]")continue;try{const ue=((d=(r=(v=JSON.parse(Q).choices)==null?void 0:v[0])==null?void 0:r.delta)==null?void 0:d.content)||"";x+=ue;const{thinking:S,content:E}=re(x);if(S){const F=i.thinking+c;if(S.length>F.length){const O=S.slice(F.length);c+=O,i.thinking=S}}if(E){const F=i.content+u;if(E.length>F.length){const O=E.slice(F.length);u+=O,i.content=E}}E&&E.length>0&&!i.thinkingFinished&&(i.thinkingFinished=!0,i.thinkingDuration=((Date.now()-i.startTime)/1e3).toFixed(1),setTimeout(()=>{i.thinkingExpanded&&(i.thinkingExpanded=!1)},800))}catch(J){console.warn("Error parsing SSE data",J)}}}i.finished=!0,!i.thinkingFinished&&i.thinking&&(i.thinkingFinished=!0,i.thinkingDuration=((Date.now()-i.startTime)/1e3).toFixed(1))}catch(p){console.error("Chat error:",p),i.displayContent+=`

**[ç³»ç»Ÿé”™è¯¯]**: ${p.message}`,i.finished=!0}finally{b.value=!1}}function V(){_e(()=>{if(L.value){const s=L.value;(s.scrollHeight-s.scrollTop-s.clientHeight<100||b.value)&&(s.scrollTop=s.scrollHeight)}})}function ce(s){if(!s)return"";const e=[];let t=s.replace(/```(\w*)\n([\s\S]*?)```/g,(i,c,u)=>{const y=`__CODE_BLOCK_${e.length}__`;return e.push({lang:c,code:u}),y});const l=[];t=t.replace(/`([^`]+)`/g,(i,c)=>{const u=`__INLINE_CODE_${l.length}__`;return l.push(c),u});const h=[];return t=t.replace(/((?:^[\t ]*\|[^\n]*\|[\t ]*$\n?)+)/gm,i=>{const c=de(i);if(c){const u=`__TABLE_${h.length}__`;return h.push(c),u}return i}),t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=t.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/^### (.+)$/gm,"<h3>$1</h3>").replace(/^## (.+)$/gm,"<h2>$1</h2>").replace(/^# (.+)$/gm,"<h1>$1</h1>").replace(/^- (.+)$/gm,"<li>$1</li>").replace(/^\d+\. (.+)$/gm,"<li>$1</li>").replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>').replace(/^&gt; (.+)$/gm,"<blockquote>$1</blockquote>").replace(/^---$/gm,"<hr>"),t=t.replace(/\n/g,"<br>"),t=t.replace(/(<li>.*<\/li>)(<br>)?/g,"$1"),t=t.replace(/(<li>.*<\/li>)+/g,"<ul>$&</ul>"),h.forEach((i,c)=>{t=t.replace(`__TABLE_${c}__`,i)}),l.forEach((i,c)=>{const u=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");t=t.replace(`__INLINE_CODE_${c}__`,`<code>${u}</code>`)}),e.forEach((i,c)=>{const u=i.code.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),y=`<div class="code-block"><div class="code-header">${i.lang||"text"}</div><pre><code class="language-${i.lang||"text"}">${u}</code></pre></div>`;t=t.replace(`__CODE_BLOCK_${c}__`,y)}),t}function de(s){const e=s.trim().split(`
`).filter(r=>r.trim()&&r.includes("|"));if(e.length<3)return null;const t=r=>{let d=r.trim();return d.startsWith("|")&&(d=d.slice(1)),d.endsWith("|")&&(d=d.slice(0,-1)),d.split("|").map(p=>p.trim())};let l=-1;for(let r=1;r<e.length&&r<3;r++)if(t(e[r]).every(p=>/^[\s:-]+$/.test(p)&&p.includes("-"))){l=r;break}if(l===-1)return null;const h=t(e[0]),i=h.length;if(i===0)return null;const u=t(e[l]).map(r=>{const d=r.trim();return d.startsWith(":")&&d.endsWith(":")?"center":d.endsWith(":")?"right":"left"}),y=[];for(let r=l+1;r<e.length;r++){const d=t(e[r]);if(d.every(k=>/^[\s:-]*$/.test(k)))continue;const p=[];for(let k=0;k<i;k++)p.push(d[k]||"");y.push(p)}if(y.length===0)return null;const W=r=>r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");let v='<div class="table-wrapper"><table class="md-table">';return v+="<thead><tr>",h.forEach((r,d)=>{const p=u[d]||"left";v+=`<th style="text-align: ${p}">${W(r)}</th>`}),v+="</tr></thead>",v+="<tbody>",y.forEach(r=>{v+="<tr>",r.forEach((d,p)=>{const k=u[p]||"left";v+=`<td style="text-align: ${k}">${W(d)}</td>`}),v+="</tr>"}),v+="</tbody>",v+="</table></div>",v}return ve(()=>{var s;(s=D.value)==null||s.focus()}),(s,e)=>(o(),a("div",xe,[n("div",Ce,[n("aside",be,[n("div",{class:"sidebar-header"},[n("button",{class:"new-chat-btn",onClick:Z},[...e[2]||(e[2]=[n("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),n("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),R(" æ–°å¯¹è¯ ",-1)])])]),n("div",Te,[e[5]||(e[5]=n("label",null,"æ¨¡å‹é€‰æ‹©",-1)),n("div",$e,[X(n("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>A.value=t)},[...e[3]||(e[3]=[n("option",{value:"gemini-3-pro"},"Gemini 3 Pro",-1),n("option",{value:"gemini-3-flash"},"Gemini 3 Flash",-1)])],512),[[fe,A.value]]),e[4]||(e[4]=n("svg",{class:"select-arrow",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("polyline",{points:"6 9 12 15 18 9"})],-1))])]),n("div",Ee,[e[8]||(e[8]=n("div",{class:"history-label"},"å†å²å¯¹è¯",-1)),(o(!0),a(I,null,H(m.value,(t,l)=>(o(),a("div",{key:l,class:N(["history-item",{active:T.value===l}]),onClick:h=>ee(l)},[e[7]||(e[7]=n("svg",{class:"history-icon",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})],-1)),n("span",Be,M(t.title||"æ–°å¯¹è¯"),1),n("button",{class:"delete-btn",onClick:Y(h=>te(l),["stop"]),title:"åˆ é™¤"},[...e[6]||(e[6]=[n("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),n("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,De)],10,Me))),128))])]),n("main",Fe,[n("div",{class:"messages-container",ref_key:"messagesContainer",ref:L},[K.value.length===0?(o(),a("div",Ae,[...e[9]||(e[9]=[ke('<div class="empty-icon" data-v-57cd3d6e><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-57cd3d6e><circle cx="12" cy="12" r="10" data-v-57cd3d6e></circle><path d="M8 14s1.5 2 4 2 4-2 4-2" data-v-57cd3d6e></path><line x1="9" y1="9" x2="9.01" y2="9" data-v-57cd3d6e></line><line x1="15" y1="9" x2="15.01" y2="9" data-v-57cd3d6e></line></svg></div><h2 data-v-57cd3d6e>å¼€å¯æ™ºèƒ½å¯¹è¯</h2><p data-v-57cd3d6e>åŸºäº Gemini 3 Pro çš„æ·±åº¦æ¨ç†æ¨¡å‹</p>',3)])])):C("",!0),(o(!0),a(I,null,H(K.value,(t,l)=>(o(),a("div",{key:l,class:N(["message-row",t.role])},[n("div",Se,[t.role==="user"?(o(),a("div",Ie,[...e[10]||(e[10]=[n("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),n("circle",{cx:"12",cy:"7",r:"4"})],-1)])])):(o(),a("div",He,[...e[11]||(e[11]=[n("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("path",{d:"M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13A1.5 1.5 0 0 0 6 14.5 1.5 1.5 0 0 0 7.5 16 1.5 1.5 0 0 0 9 14.5 1.5 1.5 0 0 0 7.5 13m9 0a1.5 1.5 0 0 0-1.5 1.5 1.5 1.5 0 0 0 1.5 1.5 1.5 1.5 0 0 0 1.5-1.5 1.5 1.5 0 0 0-1.5-1.5z"})],-1)])]))]),n("div",Ne,[t.attachments&&t.attachments.length>0?(o(),a("div",Le,[(o(!0),a(I,null,H(t.attachments,(h,i)=>(o(),a("div",{key:i},[h.type==="image"?(o(),a("img",{key:0,src:h.preview,class:"msg-image"},null,8,Ve)):(o(),a("div",We,[e[12]||(e[12]=n("span",null,"ğŸ“„",-1)),R(" "+M(h.name),1)]))]))),128))])):C("",!0),n("div",Oe,[t.role==="assistant"&&!t.displayThinking&&!t.displayContent?(o(),a("div",Re,[...e[13]||(e[13]=[n("div",{class:"typing-indicator"},[n("span"),n("span"),n("span")],-1),n("span",{class:"loading-text"},"æ­£åœ¨æ€è€ƒ...",-1)])])):C("",!0),t.thinking||t.thinkingTyping?(o(),a("div",je,[n("div",{class:"thinking-header",onClick:h=>t.thinkingExpanded=!t.thinkingExpanded},[n("div",ze,[e[14]||(e[14]=n("svg",{class:"status-icon",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("circle",{cx:"12",cy:"12",r:"10"}),n("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),n("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})],-1)),e[15]||(e[15]=n("span",null,"æ·±åº¦æ€è€ƒè¿‡ç¨‹",-1)),t.thinkingFinished?(o(),a("span",Ue,M(t.thinkingDuration)+"s",1)):(o(),a("span",Pe,"..."))]),(o(),a("svg",{class:N(["chevron",{expanded:t.thinkingExpanded}]),width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[...e[16]||(e[16]=[n("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2))],8,Ke),n("div",{class:N(["thinking-body",{expanded:t.thinkingExpanded}])},[n("div",qe,[R(M(t.displayThinking),1),t.thinkingFinished?C("",!0):(o(),a("span",Ge,"_"))])],2)])):C("",!0),t.displayContent||t.content||t.contentTyping?(o(),a("div",Qe,[n("div",{innerHTML:ce(t.displayContent||t.content)},null,8,Je),!t.finished&&t.role==="assistant"?(o(),a("span",Xe)):C("",!0)])):C("",!0)])])],2))),128))],512),n("div",Ye,[f.value.length>0?(o(),a("div",Ze,[(o(!0),a(I,null,H(f.value,(t,l)=>(o(),a("div",{key:l,class:"attachment-item"},[t.type.startsWith("image/")?(o(),a("div",et,[n("img",{src:t.preview,alt:"preview"},null,8,tt)])):(o(),a("div",nt,[e[17]||(e[17]=n("div",{class:"file-icon"},"ğŸ“„",-1)),n("span",st,M(t.name),1)])),n("button",{class:"remove-btn",onClick:h=>oe(l)},"Ã—",8,it)]))),128))])):C("",!0),n("div",lt,[n("button",{class:"upload-btn",onClick:ie,title:"ä¸Šä¼ å›¾ç‰‡æˆ–æ–‡ä»¶"},[...e[18]||(e[18]=[n("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("path",{d:"M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"})],-1)])]),n("input",{type:"file",ref_key:"fileInput",ref:j,class:"hidden-input",multiple:"",accept:"image/*,text/*,.pdf,.json,.js,.py,.html,.css,.md,.txt",onChange:le},null,544),X(n("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>B.value=t),onKeydown:me(Y(ne,["exact"]),["enter"]),onInput:se,onPaste:ae,placeholder:"è¾“å…¥é—®é¢˜... (Enter å‘é€)",rows:"1",ref_key:"inputArea",ref:D},null,40,at),[[ye,B.value]]),n("button",{class:"send-btn",onClick:P,disabled:!B.value.trim()&&f.value.length===0||b.value,title:b.value?"ç”Ÿæˆä¸­...":"å‘é€æ¶ˆæ¯"},[b.value?(o(),a("div",ct)):(o(),a("svg",rt,[...e[19]||(e[19]=[n("line",{x1:"22",y1:"2",x2:"11",y2:"13"},null,-1),n("polygon",{points:"22 2 15 22 11 13 2 9 22 2"},null,-1)])]))],8,ot)]),n("div",dt,[n("span",ht,M(A.value),1),e[20]||(e[20]=n("span",null,"AI ç”Ÿæˆå†…å®¹ä»…ä¾›å‚è€ƒ",-1))])])])])]))}},ft=pe(ut,[["__scopeId","data-v-57cd3d6e"]]);export{ft as default};
