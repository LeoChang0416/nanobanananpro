import{_ as P,r as m,o as W,w as z,c as l,a as o,b as M,d as e,n as V,e as L,v as Z,f as R,g as w,F as D,h as E,i as G,j as B,t as f,k as H,l as Q,u as Y,m as ee,p as O,q as $,s as te,x as N}from"./index-CGveUXC2.js";import{u as X,I as se,a as ae}from"./ImageModal-D3XuygON.js";const oe={class:"generate-panel"},ne={class:"form"},le={class:"form-group prompt-group"},ie={class:"form-group"},re={key:0,class:"upload-placeholder"},ce={key:1,class:"preview-grid"},de=["src","alt"],ue={class:"preview-overlay"},ve=["onClick"],pe={class:"params-section"},ge={class:"params-grid"},ke={class:"param-item"},me={class:"select-wrapper"},we={class:"param-item"},he={class:"select-wrapper"},fe=["disabled"],ye=20,xe=10*1024*1024,be={__name:"GeneratePanel",emits:["generate"],setup(a,{emit:i}){const S=i,p=X(),r=m(""),s=m("auto"),d=m("1K"),x=m(null),I=m(null),v=m([]),C=m(!1),b=m(!1);W(()=>{p.loadFormState(),j()});const j=()=>{r.value=p.formState.prompt||"",s.value=p.formState.aspectRatio||"auto",d.value=p.formState.imageSize||"1K",v.value=p.formState.referenceImages||[],setTimeout(()=>{U()},0)};z(()=>p.formState,()=>{j()},{deep:!0}),z([r,s,d],()=>{p.saveFormState({prompt:r.value,aspectRatio:s.value,imageSize:d.value})}),z(v,()=>{p.updateFormState({referenceImages:v.value})},{deep:!0});const T=()=>{var n;(n=I.value)==null||n.click()},A=n=>{const t=Array.from(n.target.files||[]);g(t),n.target.value=""},F=n=>{const t=Array.from(n.dataTransfer.files||[]);g(t)},c=n=>{b.value=!1,F(n)},g=async n=>{const t=["image/jpeg","image/jpg","image/png","image/webp"],u=n.filter(y=>t.includes(y.type)?y.size>xe?(alert(`文件 ${y.name} 超过10MB限制，已跳过`),!1):!0:!1),h=ye-v.value.length,_=u.slice(0,h);for(const y of _){const J=await k(y);v.value.push({file:y,preview:URL.createObjectURL(y),base64:J})}},k=n=>new Promise((t,u)=>{const h=new FileReader;h.onload=()=>t(h.result),h.onerror=u,h.readAsDataURL(n)}),K=n=>{URL.revokeObjectURL(v.value[n].preview),v.value.splice(n,1)},U=()=>{const n=x.value;n&&(n.style.height="0",n.style.height=Math.max(60,n.scrollHeight)+"px")},q=()=>{if(!r.value.trim())return;const n=v.value.map(t=>t.base64);S("generate",{prompt:r.value,aspectRatio:s.value,imageSize:d.value,urls:n.length>0?n:void 0})};return(n,t)=>(o(),l("div",oe,[t[17]||(t[17]=M('<div class="panel-header" data-v-aacae7c5><div class="header-icon" data-v-aacae7c5><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-aacae7c5><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" data-v-aacae7c5></polygon></svg></div><div class="header-text" data-v-aacae7c5><h2 class="title" data-v-aacae7c5>创作灵感</h2><p class="subtitle" data-v-aacae7c5>用文字描述你想要的画面，AI 将为你实现</p></div></div>',1)),e("div",ne,[e("div",le,[e("div",{class:V(["textarea-wrapper",{focused:C.value}])},[L(e("textarea",{ref_key:"textareaRef",ref:x,"onUpdate:modelValue":t[0]||(t[0]=u=>r.value=u),class:"textarea",placeholder:"描述你想要生成的画面，越详细效果越好...",onInput:U,onFocus:t[1]||(t[1]=u=>C.value=!0),onBlur:t[2]||(t[2]=u=>C.value=!1)},null,544),[[Z,r.value]])],2)]),e("div",ie,[t[10]||(t[10]=M('<div class="label-row" data-v-aacae7c5><label class="label" data-v-aacae7c5><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-aacae7c5><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-aacae7c5></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-aacae7c5></circle><polyline points="21 15 16 10 5 21" data-v-aacae7c5></polyline></svg> 参考图 </label><span class="label-hint" data-v-aacae7c5>可选，最多20张</span></div>',1)),e("div",{class:V(["upload-area",{"has-images":v.value.length>0,"drag-over":b.value}]),onClick:T,onDragover:t[3]||(t[3]=R(u=>b.value=!0,["prevent"])),onDragleave:t[4]||(t[4]=R(u=>b.value=!1,["prevent"])),onDrop:R(c,["prevent"])},[e("input",{ref_key:"fileInputRef",ref:I,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",multiple:"",class:"file-input",onChange:A},null,544),v.value.length===0?(o(),l("div",re,[...t[7]||(t[7]=[M('<div class="upload-icon-wrapper" data-v-aacae7c5><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-aacae7c5><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-aacae7c5></path><polyline points="17 8 12 3 7 8" data-v-aacae7c5></polyline><line x1="12" y1="3" x2="12" y2="15" data-v-aacae7c5></line></svg></div><p class="upload-text" data-v-aacae7c5>点击或拖拽上传参考图</p><p class="upload-hint" data-v-aacae7c5>支持 JPG、PNG、WEBP，单张不超过 10MB</p>',3)])])):(o(),l("div",ce,[(o(!0),l(D,null,E(v.value,(u,h)=>(o(),l("div",{key:h,class:"preview-item"},[e("img",{src:u.preview,alt:"参考图 "+(h+1)},null,8,de),e("div",ue,[e("button",{class:"remove-btn",onClick:R(_=>K(h),["stop"]),title:"移除"},[...t[8]||(t[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,ve)])]))),128)),v.value.length<20?(o(),l("div",{key:0,class:"add-more",onClick:R(T,["stop"])},[...t[9]||(t[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])):w("",!0)]))],34)]),e("div",pe,[t[15]||(t[15]=e("div",{class:"params-header"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"12",cy:"12",r:"3"}),e("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]),e("span",null,"生成参数")],-1)),e("div",ge,[e("div",ke,[t[12]||(t[12]=e("label",{class:"param-label"},"画面比例",-1)),e("div",me,[L(e("select",{"onUpdate:modelValue":t[5]||(t[5]=u=>s.value=u),class:"select"},[...t[11]||(t[11]=[M('<option value="auto" data-v-aacae7c5>自动</option><option value="1:1" data-v-aacae7c5>1:1 正方形</option><option value="16:9" data-v-aacae7c5>16:9 横版</option><option value="9:16" data-v-aacae7c5>9:16 竖版</option><option value="4:3" data-v-aacae7c5>4:3</option><option value="3:4" data-v-aacae7c5>3:4</option><option value="3:2" data-v-aacae7c5>3:2</option><option value="2:3" data-v-aacae7c5>2:3</option><option value="5:4" data-v-aacae7c5>5:4</option><option value="4:5" data-v-aacae7c5>4:5</option><option value="21:9" data-v-aacae7c5>21:9 超宽</option>',11)])],512),[[G,s.value]])])]),e("div",we,[t[14]||(t[14]=e("label",{class:"param-label"},"输出分辨率",-1)),e("div",he,[L(e("select",{"onUpdate:modelValue":t[6]||(t[6]=u=>d.value=u),class:"select"},[...t[13]||(t[13]=[e("option",{value:"1K"},"1K 标准",-1),e("option",{value:"2K"},"2K 高清",-1),e("option",{value:"4K"},"4K 超清",-1)])],512),[[G,d.value]])])])])]),e("button",{class:"generate-btn",onClick:q,disabled:!r.value.trim()},[...t[16]||(t[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})],-1),e("span",null,"开始生成",-1)])],8,fe)])]))}},$e=P(be,[["__scopeId","data-v-aacae7c5"]]),Se={class:"task-header"},Ce={key:0,class:"status-icon"},Re={key:1,class:"status-icon spinning"},Be={key:2,class:"status-icon"},Ie={key:3,class:"status-icon"},je={key:4,class:"status-icon"},Te={class:"status-text"},Me={key:5,class:"progress-text"},Ve={class:"task-actions"},Ae={class:"task-prompt"},Fe={class:"task-user"},ze={class:"task-meta"},Le={class:"meta-tag"},De={class:"meta-tag"},Ee={key:0,class:"meta-tag ref-tag"},Pe={key:0,class:"progress-bar"},Ke={key:1,class:"task-footer error-footer"},Ue={class:"error-text"},_e={__name:"TaskCard",props:{task:{type:Object,required:!0}},emits:["remove","retry","cancel"],setup(a){const i=a,S=B(()=>({pending:"排队中",running:"生成中",succeeded:"完成",failed:"失败",cancelled:"已取消"})[i.task.status]||i.task.status),p=B(()=>{const r=i.task.prompt||"";return r.length>50?r.substring(0,50)+"...":r});return(r,s)=>(o(),l("div",{class:V(["task-card",a.task.status])},[e("div",Se,[e("div",{class:V(["status-badge",a.task.status])},[a.task.status==="pending"?(o(),l("span",Ce,[...s[3]||(s[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("polyline",{points:"12 6 12 12 16 14"})],-1)])])):a.task.status==="running"?(o(),l("span",Re,[...s[4]||(s[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"23 4 23 10 17 10"}),e("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})],-1)])])):a.task.status==="succeeded"?(o(),l("span",Be,[...s[5]||(s[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"20 6 9 17 4 12"})],-1)])])):a.task.status==="failed"?(o(),l("span",Ie,[...s[6]||(s[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),e("line",{x1:"9",y1:"9",x2:"15",y2:"15"})],-1)])])):a.task.status==="cancelled"?(o(),l("span",je,[...s[7]||(s[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])):w("",!0),e("span",Te,f(S.value),1),a.task.status==="running"&&a.task.progress>0?(o(),l("span",Me,f(a.task.progress)+"%",1)):w("",!0)],2),e("div",Ve,[a.task.status==="pending"||a.task.status==="running"?(o(),l("button",{key:0,class:"action-icon-btn cancel",onClick:s[0]||(s[0]=d=>r.$emit("cancel",a.task.id)),title:"取消任务"},[...s[8]||(s[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),e("line",{x1:"9",y1:"9",x2:"15",y2:"15"})],-1)])])):w("",!0),a.task.status==="failed"||a.task.status==="cancelled"||a.task.status==="succeeded"?(o(),l("button",{key:1,class:"action-icon-btn close",onClick:s[1]||(s[1]=d=>r.$emit("remove",a.task.id)),title:"移除任务"},[...s[9]||(s[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])):w("",!0)])]),e("div",Ae,f(p.value),1),e("div",Fe,f(a.task.username||"匿名"),1),e("div",ze,[e("span",Le,f(a.task.aspectRatio),1),e("span",De,f(a.task.imageSize),1),a.task.hasReferenceImages?(o(),l("span",Ee,[...s[10]||(s[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e("polyline",{points:"21 15 16 10 5 21"})],-1),H(" 参考图 ",-1)])])):w("",!0)]),a.task.status==="running"||a.task.status==="pending"?(o(),l("div",Pe,[e("div",{class:"progress-fill",style:Q({width:a.task.progress+"%"})},null,4)])):w("",!0),a.task.status==="failed"?(o(),l("div",Ke,[e("p",Ue,f(a.task.error),1),e("button",{class:"retry-btn",onClick:s[2]||(s[2]=d=>r.$emit("retry",a.task.id))},[...s[11]||(s[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"23 4 23 10 17 10"}),e("polyline",{points:"1 20 1 14 7 14"}),e("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})],-1),H(" 重试 ",-1)])])])):w("",!0)],2))}},Ge=P(_e,[["__scopeId","data-v-66bcba7d"]]),He={class:"home-view"},Oe={class:"main-content"},Ne={class:"container"},We={key:0,class:"tasks-section"},Xe={class:"section-header"},qe={class:"task-count"},Je={class:"tasks-grid"},Ze={key:0,class:"expand-controls"},Qe={class:"expand-icon"},Ye={key:1,class:"recent-section"},et={class:"image-grid"},tt=3,st=2,at={__name:"HomeView",setup(a){const i=X(),S=Y(),p=te(),r=m(!1),s=m(null),d=m(!1),x=tt*st,I=B(()=>d.value||i.tasks.length<=x?i.tasks:i.tasks.slice(0,x)),v=B(()=>i.tasks.length>x),C=()=>{d.value=!d.value},b=B(()=>i.images.slice(0,8)),j=async c=>{if(!S.isLoggedIn){p.push("/login");return}i.createTask(c)},T=c=>{s.value=c,r.value=!0},A=async c=>{if(confirm("确定要删除这张图片吗？"))try{await i.deleteImage(c)}catch{alert("删除失败")}},F=c=>{const g=(c.urls||[]).map((k,K)=>({preview:k,base64:k,file:null}));i.updateFormState({prompt:c.prompt,aspectRatio:c.aspectRatio,imageSize:c.imageSize,referenceImages:g}),i.saveFormState({prompt:c.prompt,aspectRatio:c.aspectRatio,imageSize:c.imageSize})};return W(()=>{i.init()}),ee(()=>{i.stopPolling()}),(c,g)=>(o(),l("div",He,[e("main",Oe,[e("div",Ne,[O($e,{onGenerate:j}),$(i).tasks.length>0?(o(),l("section",We,[e("div",Xe,[g[1]||(g[1]=e("h3",{class:"section-title"},"生成任务",-1)),e("span",qe,f($(i).tasks.length)+"个任务",1)]),e("div",Je,[(o(!0),l(D,null,E(I.value,k=>(o(),N(Ge,{key:k.id,task:k,onRemove:$(i).removeTask,onRetry:$(i).retryTask,onCancel:$(i).cancelTask},null,8,["task","onRemove","onRetry","onCancel"]))),128))]),v.value?(o(),l("div",Ze,[e("button",{class:"expand-btn",onClick:C},[e("span",null,f(d.value?"收起":"展开更多"),1),e("span",Qe,f(d.value?"▲":"▼"),1)])])):w("",!0)])):w("",!0),$(i).images.length>0?(o(),l("section",Ye,[g[2]||(g[2]=e("h3",{class:"section-title"},"最近生成",-1)),e("div",et,[(o(!0),l(D,null,E(b.value,k=>(o(),N(ae,{key:k.id,image:k,onView:T,onDelete:A,onRegenerate:F},null,8,["image"]))),128))])])):w("",!0)])]),O(se,{visible:r.value,image:s.value,onClose:g[0]||(g[0]=k=>r.value=!1)},null,8,["visible","image"])]))}},lt=P(at,[["__scopeId","data-v-d240bdcf"]]);export{lt as default};
