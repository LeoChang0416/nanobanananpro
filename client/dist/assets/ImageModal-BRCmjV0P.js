import{B,r as w,_ as z,c as C,a as b,d as a,b as $,t as d,g as _,n as A,q as M,f as N,T as V}from"./index-CrRd_1UB.js";import{i as I,t as k}from"./index-_2kYfvNG.js";const ie=B("image",()=>{const s=w([]),m=w(!1),o=w([]);let r=null;const i=w({prompt:"",aspectRatio:"auto",imageSize:"1K",referenceImages:[]}),g=()=>{try{const t=localStorage.getItem("nano-banana-form-state");if(t){const e=JSON.parse(t);i.value={...i.value,...e}}}catch(t){console.error("恢复表单状态失败:",t)}},u=t=>{try{i.value={...i.value,...t};const e={prompt:i.value.prompt,aspectRatio:i.value.aspectRatio,imageSize:i.value.imageSize};localStorage.setItem("nano-banana-form-state",JSON.stringify(e))}catch(e){console.error("保存表单状态失败:",e)}},v=t=>{i.value={...i.value,...t}},c=async()=>{m.value=!0;try{const t=await I.getList();s.value=t.images||[]}catch(t){console.error("获取图片列表失败:",t)}finally{m.value=!1}},n=async()=>{try{const t=await k.getAll();o.value=t.tasks||[]}catch(t){console.error("获取任务列表失败:",t)}},h=()=>{r||(r=setInterval(async()=>{if(o.value.filter(e=>e.status==="pending"||e.status==="running").length!==0)try{((await k.getAll()).tasks||[]).forEach(l=>{const x=o.value.findIndex(T=>T.id===l.id);x>-1?(o.value[x].status!=="succeeded"&&l.status==="succeeded"&&(c(),setTimeout(()=>{S(l.id)},5e3)),o.value[x]=l):(l.status==="pending"||l.status==="running")&&o.value.push(l)})}catch(e){console.error("轮询任务失败:",e)}},2e3))},y=()=>{r&&(clearInterval(r),r=null)},f=async t=>{try{const e=await I.generate(t);return e.task&&o.value.unshift(e.task),h(),e.taskId}catch(e){throw console.error("创建任务失败:",e),e}},R=async t=>{try{await k.cancel(t);const e=o.value.find(p=>p.id===t);e&&(e.status="cancelled")}catch(e){throw console.error("取消任务失败:",e),e}},S=async t=>{try{await k.delete(t)}catch{}const e=o.value.findIndex(p=>p.id===t);e>-1&&o.value.splice(e,1)};return{images:s,loading:m,tasks:o,formState:i,fetchImages:c,fetchTasks:n,createTask:f,cancelTask:R,removeTask:S,retryTask:async t=>{const e=o.value.find(l=>l.id===t);if(!e)return;const p={prompt:e.prompt,aspectRatio:e.aspectRatio,imageSize:e.imageSize};await S(t),await f(p)},deleteImage:async t=>{try{await I.delete(t),s.value=s.value.filter(e=>e.id!==t)}catch(e){throw console.error("删除图片失败:",e),e}},init:async()=>{await Promise.all([c(),n()]),h()},startPolling:h,stopPolling:y,loadFormState:g,saveFormState:u,updateFormState:v}}),j={class:"image-card"},P={class:"image-wrapper"},D=["src","alt"],L={class:"card-info"},O={class:"prompt"},F={class:"meta-row"},q={class:"time"},E={class:"specs"},J={__name:"ImageCard",props:{image:{type:Object,required:!0}},emits:["view","delete","regenerate"],setup(s,{emit:m}){const o=s,r=m,i=()=>{r("view",o.image)},g=()=>{r("delete",o.image.id)},u=()=>{r("regenerate",{prompt:o.image.prompt,aspectRatio:o.image.aspectRatio,imageSize:o.image.imageSize,urls:o.image.referenceUrls||[]})},v=c=>new Date(c).toLocaleString("zh-CN",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"});return(c,n)=>(b(),C("div",j,[a("div",P,[a("img",{src:s.image.url,alt:s.image.prompt,class:"image"},null,8,D),a("div",{class:"overlay"},[a("button",{class:"action-btn view",onClick:i,title:"查看大图"},[...n[0]||(n[0]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[a("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),a("circle",{cx:"12",cy:"12",r:"3"})],-1)])]),a("button",{class:"action-btn regenerate",onClick:u,title:"重新生成"},[...n[1]||(n[1]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[a("polyline",{points:"23 4 23 10 17 10"}),a("polyline",{points:"1 20 1 14 7 14"}),a("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})],-1)])]),a("button",{class:"action-btn delete",onClick:g,title:"删除"},[...n[2]||(n[2]=[$('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-9680a1bb><polyline points="3 6 5 6 21 6" data-v-9680a1bb></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" data-v-9680a1bb></path><line x1="10" y1="11" x2="10" y2="17" data-v-9680a1bb></line><line x1="14" y1="11" x2="14" y2="17" data-v-9680a1bb></line></svg>',1)])])])]),a("div",L,[a("p",O,d(s.image.prompt),1),a("div",F,[a("p",q,d(v(s.image.createdAt)),1),a("p",E,d(s.image.aspectRatio)+" · "+d(s.image.imageSize),1),s.image.apiType?(b(),C("span",{key:0,class:A(["api-badge",s.image.apiType])},d(s.image.apiType==="primary"?"主":"备"),3)):_("",!0)])])]))}},ne=z(J,[["__scopeId","data-v-9680a1bb"]]),H={class:"image-container"},K=["src","alt"],U={class:"modal-info"},G={class:"prompt"},Q={class:"meta"},W={class:"tag"},X={class:"tag"},Y={class:"time"},Z={__name:"ImageModal",props:{visible:Boolean,image:Object},emits:["close"],setup(s,{emit:m}){const o=m,r=()=>{o("close")},i=g=>g?new Date(g).toLocaleString("zh-CN"):"";return(g,u)=>{var v,c,n,h,y,f;return b(),M(V,{to:"body"},[s.visible?(b(),C("div",{key:0,class:"modal-overlay",onClick:r},[a("div",{class:"modal-content",onClick:u[0]||(u[0]=N(()=>{},["stop"]))},[a("button",{class:"close-btn",onClick:r},"×"),a("div",H,[a("img",{src:(v=s.image)==null?void 0:v.url,alt:(c=s.image)==null?void 0:c.prompt,class:"modal-image"},null,8,K)]),a("div",U,[a("p",G,d((n=s.image)==null?void 0:n.prompt),1),a("div",Q,[a("span",W,d((h=s.image)==null?void 0:h.aspectRatio),1),a("span",X,d((y=s.image)==null?void 0:y.imageSize),1),a("span",Y,d(i((f=s.image)==null?void 0:f.createdAt)),1)])])])])):_("",!0)])}}},re=z(Z,[["__scopeId","data-v-d920e3a5"]]);export{re as I,ne as a,ie as u};
